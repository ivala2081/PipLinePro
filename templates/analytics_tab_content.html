{# Analytics Tab Content (moved from clients.html) #}
<div class="container-fluid px-0" id="analytics-tab-content">


  <!-- All-Time Analytics Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm h-100">
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle bg-success-subtle">
              <i class="bi bi-arrow-up-circle text-success fs-2"></i>
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Total Deposits</div>
          <div class="analytics-value fs-3 fw-bold text-success mb-2">
            {% if analytics_data and analytics_data.all %}{{ analytics_data.all.total_deposits|format_number }}{% else %}0{% endif %} TL
          </div>
          <div class="text-muted small">All-time cumulative</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle bg-danger-subtle">
              <i class="bi bi-arrow-down-circle text-danger fs-2"></i>
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Total Withdraws</div>
          <div class="analytics-value fs-3 fw-bold text-danger mb-2">
            {% if analytics_data and analytics_data.all %}{{ analytics_data.all.total_withdraws|format_number }}{% else %}0{% endif %} TL
          </div>
          <div class="text-muted small text-muted small">All-time cumulative</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle bg-warning-subtle">
              <i class="bi bi-percent text-warning fs-2"></i>
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Total Commissions</div>
          <div class="analytics-value fs-3 fw-bold text-warning mb-2">
            {% if analytics_data and analytics_data.all %}{{"{:.2f}".format(analytics_data.all.total_commissions) }}{% else %}0.00{% endif %} TL
          </div>
          <div class="text-muted small text-muted small">All-time cumulative</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle 
              {% if analytics_data and analytics_data.all and analytics_data.all.status =="Profitable" %}bg-success-subtle
              {% elif analytics_data and analytics_data.all and analytics_data.all.status =="Loss" %}bg-danger-subtle
              {% else %}bg-warning-subtle{% endif %}">
              {% if analytics_data and analytics_data.all and analytics_data.all.status =="Profitable" %}
                <i class="bi bi-check-circle text-success fs-2"></i>
              {% elif analytics_data and analytics_data.all and analytics_data.all.status =="Loss" %}
                <i class="bi bi-x-circle text-danger fs-2"></i>
              {% else %}
                <i class="bi bi-dash-circle text-warning fs-2"></i>
              {% endif %}
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Status</div>
          <div class="analytics-value fs-3 fw-bold mb-2">
            {% if analytics_data and analytics_data.all %}
              {% if analytics_data.all.status =="Profitable" %}
                <span class="text-success">{{ analytics_data.all.status }}</span>
              {% elif analytics_data.all.status =="Loss" %}
                <span class="text-danger">{{ analytics_data.all.status }}</span>
              {% else %}
                <span class="text-warning">{{ analytics_data.all.status or 'No Data' }}</span>
              {% endif %}
            {% else %}
              <span class="text-warning">No Data</span>
            {% endif %}
          </div>
          <div class="text-muted small text-muted small">Overall performance</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced All-Time Charts -->
  <div class="row g-3 mb-4">
    <div class="col-lg-8">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-primary text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-graph-up-arrow me-2"></i>All-Time Transaction Volume Trend</h6>
        </div>
        <div class="card-body position-relative">
          {% if analytics_data and analytics_data.all and analytics_data.all.volume_over_time %}
            <canvas id="allVolumeChart" height="200" data-labels='{{ analytics_data.all.volume_over_time.keys()|list|tojson }}' data-values='{{ analytics_data.all.volume_over_time.values()|list|tojson }}'></canvas>
          {% else %}
            <div class="no-data-overlay">
              <div class="no-data-content">
                <i class="bi bi-graph-up-arrow text-muted fs-1 mb-3"></i>
                <h5 class="text-muted">No Data Available</h5>
                <p class="text-muted mb-0">No transactions found in the system</p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-info text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-pie-chart me-2"></i>All-Time Transaction Distribution</h6>
        </div>
        <div class="card-body position-relative">
          {% if analytics_data and analytics_data.all and analytics_data.all.type_breakdown %}
            <canvas id="allTypeChart" height="200" data-labels='{{ analytics_data.all.type_breakdown.keys()|list|tojson }}' data-values='{{ analytics_data.all.type_breakdown.values()|list|tojson }}'></canvas>
          {% else %}
            <div class="no-data-overlay">
              <div class="no-data-content">
                <i class="bi bi-pie-chart text-muted fs-1 mb-3"></i>
                <h5 class="text-muted">No Data Available</h5>
                <p class="text-muted mb-0">No transactions found in the system</p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced All-Time Net Amount Chart -->
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-success text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-bar-chart me-2"></i>Net Amount Trend Analysis</h6>
        </div>
        <div class="card-body position-relative">
          {% if analytics_data and analytics_data.all and analytics_data.all.net_amount_over_time %}
            <canvas id="allNetAmountChart" height="200" data-labels='{{ analytics_data.all.net_amount_over_time.keys()|list|tojson }}' data-values='{{ analytics_data.all.net_amount_over_time.values()|list|tojson }}'></canvas>
          {% else %}
            <div class="no-data-overlay">
              <div class="no-data-content">
                <i class="bi bi-bar-chart text-muted fs-1 mb-3"></i>
                <h5 class="text-muted">No Data Available</h5>
                <p class="text-muted mb-0">No transactions found in the system</p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Performance Metrics Row -->
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-success text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-people me-2"></i>Top Performing Clients</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Rank</th>
                  <th>Client</th>
                  <th class="text-end">Volume (TL)</th>
                  <th class="text-end">% of Total</th>
                </tr>
              </thead>
              <tbody>
                {% if analytics_data and analytics_data.all %}
                  {% for client, vol in analytics_data.all.top_clients %}
                <tr>
                  <td><span class="badge bg-primary">{{ loop.index }}</span></td>
                  <td><strong>{{ client }}</strong></td>
                  <td class="text-end fw-bold">{{ vol|format_number }}</td>
                  <td class="text-end text-muted">{{"{:.1f}".format(vol / analytics_data.all.total_volume * 100) }}%</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="4" class="text-center text-muted">No data available</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-warning text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-trophy me-2"></i>Largest Transactions</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Client</th>
                  <th>Date</th>
                  <th class="text-end">Amount</th>
                </tr>
              </thead>
              <tbody>
                {% if analytics_data and analytics_data.all %}
                  {% for txn in analytics_data.all.biggest_transactions %}
                <tr>
                  <td><strong>{{ txn.client_name }}</strong><br><small class="text-muted">{{ txn.category }}</small></td>
                  <td>{{ txn.date }}</td>
                  <td class="text-end fw-bold text-success">{{ txn.amount|format_number }} {{ txn.currency }}</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="3" class="text-center text-muted">No data available</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Monthly Reports Heading and Month Picker -->
  <div class="row mb-3 mt-5">
    <div class="col">
      <div class="card shadow-sm">
        <div class="card-header bg-gradient-secondary text-white">
          <div class="d-flex align-items-center justify-content-between">
            <h5 class="fw-bold mb-0"><i class="bi bi-calendar3 me-2"></i>Monthly Performance Report - {{ selected_month.strftime('%B %Y') }}</h5>
            <form method="get" class="d-inline-block" id="monthPickerForm">
              <label for="monthPickerSelect">Select Month</label>
    <select name="month" class="form-select form-select-sm d-inline-block w-auto" id="monthPickerSelect">
                {% set now = now or selected_month %}
                {% for i in range(0, 12) %}
                  {% set current_year = now.year %}
                  {% set current_month = now.month %}
                  {% set target_month = current_month - i - 1 %}
                  {% if target_month <= 0 %}
                    {% set target_month = target_month + 12 %}
                    {% set target_year = current_year - 1 %}
                  {% else %}
                    {% set target_year = current_year %}
                  {% endif %}
                  {% set m = now.replace(year=target_year, month=target_month, day=1) %}
                  <option value="{{ m.strftime('%Y-%m') }}" {% if m.strftime('%Y-%m') == selected_month.strftime('%Y-%m') %}selected{% endif %}>{{ m.strftime('%B %Y') }}</option>
                {% endfor %}
              </select>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Monthly Analytics Cards -->
  <div class="row g-3 mb-4">
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle bg-success-subtle">
              <i class="bi bi-bank text-success fs-2"></i>
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Total Deposits</div>
          <div class="analytics-value fs-3 fw-bold text-success mb-2">
            {% if analytics_data and analytics_data.month %}{{ analytics_data.month.total_deposits|format_number }}{% else %}0{% endif %} TL
          </div>
          <div class="text-muted small text-muted small">This month</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle bg-danger-subtle">
              <i class="bi bi-cash-stack text-danger fs-2"></i>
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Total Withdraws</div>
          <div class="analytics-value fs-3 fw-bold text-danger mb-2">
            {% if analytics_data and analytics_data.month %}{{ analytics_data.month.total_withdraws|format_number }}{% else %}0{% endif %} TL
          </div>
          <div class="text-muted small text-muted small">This month</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle bg-warning-subtle">
              <i class="bi bi-piggy-bank text-warning fs-2"></i>
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Total Commissions</div>
          <div class="analytics-value fs-3 fw-bold text-warning mb-2">
            {% if analytics_data and analytics_data.month %}{{"{:.2f}".format(analytics_data.month.total_commissions) }}{% else %}0.00{% endif %} TL
          </div>
          <div class="text-muted small text-muted small">This month</div>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card shadow-sm h-100".strip()>
        <div class="card-body text-center p-4">
          <div class="analytics-icon mb-3">
            <div class="icon-circle 
              {% if analytics_data and analytics_data.month and analytics_data.month.status =="Profitable" %}bg-success-subtle
              {% elif analytics_data and analytics_data.month and analytics_data.month.status =="Loss" %}bg-danger-subtle
              {% else %}bg-warning-subtle{% endif %}">
              {% if analytics_data and analytics_data.month and analytics_data.month.status =="Profitable" %}
                <i class="bi bi-trending-up text-success fs-2"></i>
              {% elif analytics_data and analytics_data.month and analytics_data.month.status =="Loss" %}
                <i class="bi bi-trending-down text-danger fs-2"></i>
              {% else %}
                <i class="bi bi-dash-circle text-warning fs-2"></i>
              {% endif %}
            </div>
          </div>
          <div class="analytics-label mb-2 fw-semibold text-muted text-uppercase small">Status</div>
          <div class="analytics-value fs-3 fw-bold mb-2">
            {% if analytics_data and analytics_data.month %}
              {% if analytics_data.month.status =="Profitable" %}
                <span class="text-success">{{ analytics_data.month.status }}</span>
              {% elif analytics_data.month.status =="Loss" %}
                <span class="text-danger">{{ analytics_data.month.status }}</span>
              {% else %}
                <span class="text-warning">{{ analytics_data.month.status or 'No Data' }}</span>
              {% endif %}
            {% else %}
              <span class="text-warning">No Data</span>
            {% endif %}
          </div>
          <div class="text-muted small text-muted small">Monthly performance</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Enhanced Monthly Charts -->
  <div class="row g-3 mb-4">
    <div class="col-lg-8">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-primary text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-graph-up-arrow me-2"></i>Monthly Transaction Volume Trend</h6>
        </div>
        <div class="card-body position-relative">
          {% if analytics_data and analytics_data.month and analytics_data.month.volume_over_time %}
            <canvas id="monthVolumeChart" height="200" data-labels='{{ analytics_data.month.volume_over_time.keys()|list|tojson }}' data-values='{{ analytics_data.month.volume_over_time.values()|list|tojson }}'></canvas>
          {% else %}
            <div class="no-data-overlay">
              <div class="no-data-content">
                <i class="bi bi-bar-chart text-muted fs-1 mb-3"></i>
                <h5 class="text-muted">No Data Available</h5>
                <p class="text-muted mb-0">No transactions found for {{ selected_month.strftime('%B %Y') }}</p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-lg-4">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-info text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-pie-chart me-2"></i>Monthly Transaction Distribution</h6>
        </div>
        <div class="card-body position-relative">
          {% if analytics_data and analytics_data.month and analytics_data.month.type_breakdown %}
            <canvas id="monthTypeChart" height="200" data-labels='{{ analytics_data.month.type_breakdown.keys()|list|tojson }}' data-values='{{ analytics_data.month.type_breakdown.values()|list|tojson }}'></canvas>
          {% else %}
            <div class="no-data-overlay">
              <div class="no-data-content">
                <i class="bi bi-pie-chart text-muted fs-1 mb-3"></i>
                <h5 class="text-muted">No Data Available</h5>
                <p class="text-muted mb-0">No transactions found for {{ selected_month.strftime('%B %Y') }}</p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Monthly Net Amount Bar Chart -->
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-success text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-bar-chart me-2"></i>Monthly Net Amount Trend Analysis</h6>
        </div>
        <div class="card-body position-relative">
          {% if analytics_data and analytics_data.month and analytics_data.month.net_amount_over_time %}
            <canvas id="monthNetAmountChart" height="200" data-labels='{{ analytics_data.month.net_amount_over_time.keys()|list|tojson }}' data-values='{{ analytics_data.month.net_amount_over_time.values()|list|tojson }}'></canvas>
          {% else %}
            <div class="no-data-overlay">
              <div class="no-data-content">
                <i class="bi bi-bar-chart text-muted fs-1 mb-3"></i>
                <h5 class="text-muted">No Data Available</h5>
                <p class="text-muted mb-0">No transactions found for {{ selected_month.strftime('%B %Y') }}</p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
  
  <!-- Monthly Performance Tables -->
  <div class="row g-3 mb-4">
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-success text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-people me-2"></i>Monthly Top Clients</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Rank</th>
                  <th>Client</th>
                  <th class="text-end">Volume (TL)</th>
                  <th class="text-end">% of Total</th>
                </tr>
              </thead>
              <tbody>
                {% if analytics_data and analytics_data.month %}
                  {% for client, vol in analytics_data.month.top_clients %}
                <tr>
                  <td><span class="badge bg-primary">{{ loop.index }}</span></td>
                  <td><strong>{{ client }}</strong></td>
                  <td class="text-end fw-bold">{{ vol|format_number }}</td>
                  <td class="text-end text-muted">{{"{:.1f}".format(vol / analytics_data.month.total_volume * 100) }}%</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="4" class="text-center text-muted">No data available</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-header bg-gradient-warning text-white">
          <h6 class="fw-bold mb-0"><i class="bi bi-trophy me-2"></i>Monthly Largest Transactions</h6>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>Client</th>
                  <th>Date</th>
                  <th class="text-end">Amount</th>
                </tr>
              </thead>
              <tbody>
                {% if analytics_data and analytics_data.month %}
                  {% for txn in analytics_data.month.biggest_transactions %}
                <tr>
                  <td><strong>{{ txn.client_name }}</strong><br><small class="text-muted">{{ txn.category }}</small></td>
                  <td>{{ txn.date }}</td>
                  <td class="text-end fw-bold text-success">{{ txn.amount|format_number }} {{ txn.currency }}</td>
                </tr>
                {% endfor %}
                {% else %}
                <tr><td colspan="3" class="text-center text-muted">No data available</td></tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

 