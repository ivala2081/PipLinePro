import { useState, useEffect, lazy, Suspense } from 'react';
import {
  Settings as SettingsIcon,
  Shield,
  Users,
  Lock,
  Activity,
  Database,
  FileText,
  Bell,
  Globe,
  Zap,
  Calendar,
  UserCheck,
  Building,
  TrendingUp,
  List,
  Plus,
  Edit,
  Trash2,
  X,
  Mail,
  Phone,
  RefreshCw,
  Monitor,
  BarChart3,
  Download,
  CheckCircle,
  Clock,
  Circle,
  Building2,
} from 'lucide-react';
import { useLanguage } from '../contexts/LanguageContext';
import { api } from '../utils/apiClient';
import { PageHeader, Section, ContentArea } from '../components/ProfessionalLayout';
import LoadingSpinner from '../components/LoadingSpinner';

// Lazy load SystemMonitor component
const SystemMonitor = lazy(() => import('./SystemMonitor'));

interface Tab {
  id: string;
  name: string;
  icon: any;
  content: React.ReactNode;
}

interface DropdownOption {
  id: number;
  value: string;
  commission_rate?: number;
  created_at?: string;
}

interface GroupedOptions {
  [fieldName: string]: DropdownOption[];
}

interface FieldType {
  value: string;
  label: string;
  requiresCommission: boolean;
  isStatic?: boolean;
  staticValues?: string[];
}

export default function Settings() {
  const [activeTab, setActiveTab] = useState('general');
  const [showSystemMonitor, setShowSystemMonitor] = useState(false);
  const { t, currentLanguage, setLanguage, supportedLanguages } = useLanguage();
  
  // Fallback values in case language context is not available
  const safeCurrentLanguage = currentLanguage || 'en';
  const safeSupportedLanguages = supportedLanguages || { en: { flag: '🇺🇸', name: 'English' }, tr: { flag: '🇹🇷', name: 'Türkçe' } };

  // Check URL parameters for initial tab and monitor view
  useEffect(() => {
    const urlParams = new URLSearchParams(window.location.search);
    const tabParam = urlParams.get('tab');
    const viewParam = urlParams.get('view');
    
    if (
      tabParam &&
      [
        'general',
        'dropdowns',
        'departments',
        'admin',
        'notifications',
        'integrations',
        'translations',
      ].includes(tabParam)
    ) {
      setActiveTab(tabParam);
    }
    
    // If tab is admin and view is monitor, show system monitor
    if (tabParam === 'admin' && viewParam === 'monitor') {
      setActiveTab('admin');
      setShowSystemMonitor(true);
    }
  }, []);

  // Dropdown management state
  const [dropdownOptions, setDropdownOptions] = useState<GroupedOptions>({});
  const [loadingOptions, setLoadingOptions] = useState(false);
  const [showAddModal, setShowAddModal] = useState(false);
  const [showEditModal, setShowEditModal] = useState(false);
  const [selectedOption, setSelectedOption] = useState<DropdownOption | null>(
    null
  );
  const [editingOption, setEditingOption] = useState<DropdownOption | null>(
    null
  );
  const [formData, setFormData] = useState({
    field_name: '',
    value: '',
    commission_rate: '',
  });

  // Department management state
  const [departments, setDepartments] = useState<string[]>([
    'Conversion', 'Retention', 'Marketing', 'Research', 'Operation', 'Management', 'Facility'
  ]);
  const [loadingDepartments, setLoadingDepartments] = useState(false);
  const [showDepartmentModal, setShowDepartmentModal] = useState(false);
  const [editingDepartment, setEditingDepartment] = useState<string>('');
  const [newDepartment, setNewDepartment] = useState('');
  const [isEditingDepartment, setIsEditingDepartment] = useState(false);

  const fieldTypes = [
    // Static fields (cannot be modified)
    { 
      value: 'payment_method', 
      label: 'Payment Method', 
      requiresCommission: false,
      isStatic: true,
      staticValues: ['Bank', 'Credit card', 'Tether']
    },
    { 
      value: 'currency', 
      label: 'Currency', 
      requiresCommission: false,
      isStatic: true,
      staticValues: ['TL', 'USD', 'EUR']
    },
    { 
      value: 'category', 
      label: 'Category', 
      requiresCommission: false,
      isStatic: true,
      staticValues: ['DEP', 'WD']
    },
    // Dynamic fields (can be managed)
    { value: 'psp', label: 'PSP/KASA', requiresCommission: true, isStatic: false },
    { value: 'company', label: 'Company', requiresCommission: false, isStatic: false },
  ];

  // Fetch dropdown options
  const fetchDropdownOptions = async () => {
    try {
      setLoadingOptions(true);
      const response = await api.get('/api/v1/transactions/dropdown-options');

      if (response.ok) {
        const data = await api.parseResponse(response);
        setDropdownOptions(data || {});
      } else {
        console.error('Failed to fetch dropdown options');
      }
    } catch (error) {
      console.error('Error fetching dropdown options:', error);
    } finally {
      setLoadingOptions(false);
    }
  };

  // Department management functions
  const fetchDepartments = async () => {
    try {
      setLoadingDepartments(true);
      // Load departments from localStorage or use default
      const savedDepartments = localStorage.getItem('systemDepartments');
      if (savedDepartments) {
        setDepartments(JSON.parse(savedDepartments));
      } else {
        // Default departments
        const defaultDepartments = [
          'Conversion', 'Retention', 'Marketing', 'Research', 'Operation', 'Management', 'Facility'
        ];
        setDepartments(defaultDepartments);
        localStorage.setItem('systemDepartments', JSON.stringify(defaultDepartments));
      }
    } catch (error) {
      console.error('Error fetching departments:', error);
    } finally {
      setLoadingDepartments(false);
    }
  };

  const handleAddDepartment = async () => {
    if (!newDepartment.trim()) return;
    
    try {
      // Check if department already exists
      if (departments.includes(newDepartment.trim())) {
        alert('Department already exists!');
        return;
      }
      
      const updatedDepartments = [...departments, newDepartment.trim()];
      setDepartments(updatedDepartments);
      
      // Save to localStorage
      localStorage.setItem('systemDepartments', JSON.stringify(updatedDepartments));
      
      setNewDepartment('');
      setShowDepartmentModal(false);
      
      console.log('Department added:', newDepartment);
    } catch (error) {
      console.error('Error adding department:', error);
    }
  };

  const handleEditDepartment = async () => {
    if (!editingDepartment.trim()) return;
    
    try {
      // Find the original department name being edited
      const originalDepartment = departments.find(dept => dept !== editingDepartment);
      if (!originalDepartment) {
        alert('Department not found!');
        return;
      }
      
      // Check if new name already exists
      if (departments.includes(editingDepartment.trim()) && editingDepartment.trim() !== originalDepartment) {
        alert('Department name already exists!');
        return;
      }
      
      const updatedDepartments = departments.map(dept => 
        dept === originalDepartment ? editingDepartment.trim() : dept
      );
      setDepartments(updatedDepartments);
      
      // Save to localStorage
      localStorage.setItem('systemDepartments', JSON.stringify(updatedDepartments));
      
      setEditingDepartment('');
      setIsEditingDepartment(false);
      setShowDepartmentModal(false);
      
      console.log('Department updated:', editingDepartment);
    } catch (error) {
      console.error('Error updating department:', error);
    }
  };

  const handleDeleteDepartment = async (department: string) => {
    if (!confirm(`Are you sure you want to delete the department "${department}"? This action cannot be undone.`)) {
      return;
    }
    
    try {
      const updatedDepartments = departments.filter(dept => dept !== department);
      setDepartments(updatedDepartments);
      
      // Save to localStorage
      localStorage.setItem('systemDepartments', JSON.stringify(updatedDepartments));
      
      console.log('Department deleted:', department);
    } catch (error) {
      console.error('Error deleting department:', error);
    }
  };

  const openDepartmentModal = (department?: string) => {
    if (department) {
      setEditingDepartment(department);
      setIsEditingDepartment(true);
    } else {
      setNewDepartment('');
      setIsEditingDepartment(false);
    }
    setShowDepartmentModal(true);
  };

  useEffect(() => {
    if (activeTab === 'dropdowns') {
      fetchDropdownOptions();
    }
    if (activeTab === 'departments') {
      fetchDepartments();
    }
  }, [activeTab]);

  const handleLanguageChange = async (language: string) => {
    try {
      await setLanguage(language as any);
    } catch (error) {
      console.error('Failed to change language:', error);
    }
  };

  // Function to update URL when navigating to monitor view
  const navigateToMonitor = () => {
    setShowSystemMonitor(true);
    // Update URL to reflect the monitor view
    const url = new URL(window.location.href);
    url.searchParams.set('tab', 'admin');
    url.searchParams.set('view', 'monitor');
    window.history.pushState({}, '', url.toString());
  };

  const navigateBackToAdmin = () => {
    setShowSystemMonitor(false);
    // Update URL to remove monitor view
    const url = new URL(window.location.href);
    url.searchParams.set('tab', 'admin');
    url.searchParams.delete('view');
    window.history.pushState({}, '', url.toString());
  };

  // Dropdown management functions
  const handleAddOption = async () => {
    try {
      // The API client automatically handles CSRF tokens
      const response = await api.post(
        '/api/v1/transactions/dropdown-options',
        formData
      );
      if (response.ok) {
        setShowAddModal(false);
        setFormData({ field_name: '', value: '', commission_rate: '' });
        await fetchDropdownOptions();
        alert('Option added successfully!');
      } else {
        const data = await api.parseResponse(response);
        alert(data?.error || 'Failed to add option');
      }
    } catch (error) {
      console.error('Error adding option:', error);
      alert('Failed to add option. Please try again.');
    }
  };

  const handleEditOption = async () => {
    if (!editingOption) return;

    try {
      const response = await api.put(
        `/api/v1/transactions/dropdown-options/${editingOption.id}`,
        {
          value: formData.value,
          commission_rate: formData.commission_rate,
        }
      );
      if (response.ok) {
        setShowEditModal(false);
        setEditingOption(null);
        setFormData({ field_name: '', value: '', commission_rate: '' });
        await fetchDropdownOptions();
        alert('Option updated successfully!');
      } else {
        const data = await api.parseResponse(response);
        alert(data?.error || 'Failed to update option');
      }
    } catch (error) {
      console.error('Error updating option:', error);
      alert('Failed to update option. Please try again.');
    }
  };

  const handleDeleteOption = async (option: DropdownOption) => {
    if (!confirm('Are you sure you want to delete this option?')) return;

    try {
      const response = await api.delete(
        `/api/v1/transactions/dropdown-options/${option.id}`
      );
      if (response.ok) {
        await fetchDropdownOptions();
        alert('Option deleted successfully!');
      } else {
        const data = await api.parseResponse(response);
        alert(data?.error || 'Failed to delete option');
      }
    } catch (error) {
      console.error('Error deleting option:', error);
      alert('Failed to delete option. Please try again.');
    }
  };

  const openEditModal = (option: DropdownOption, fieldName: string) => {
    setEditingOption(option);
    setFormData({
      field_name: fieldName,
      value: option.value,
      commission_rate: option.commission_rate?.toString() || '',
    });
    setShowEditModal(true);
  };

  const tabs = [
    {
      id: 'general',
      label: t('settings.general'),
      icon: SettingsIcon,
      content: (
        <div className='space-y-6'>
          {/* Company Information */}
          <div className='bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-6 border border-slate-200'>
            <div className='flex items-center gap-4 mb-6'>
              <div className='w-12 h-12 bg-gradient-to-br from-slate-700 to-blue-600 rounded-xl flex items-center justify-center shadow-lg'>
                <Building className='h-6 w-6 text-white' />
              </div>
              <div>
                <h3 className='text-xl font-bold text-slate-900'>
                  Company Information
                </h3>
                <p className='text-slate-600 font-medium'>Order Invest & PipLine Collaboration</p>
              </div>
            </div>
            
            <div className='grid grid-cols-1 md:grid-cols-2 gap-6'>
              <div className='bg-white rounded-lg p-4 border border-slate-200'>
                <label className='block text-sm font-semibold text-slate-700 mb-2'>
                  Company Name
                </label>
                <div className='flex items-center gap-2'>
                  <span className='text-lg font-bold text-slate-900'>Order Invest</span>
                  <span className='text-slate-500'>×</span>
                  <span className='text-lg font-bold text-blue-600'>PipLine</span>
                </div>
                <p className='text-xs text-slate-500 mt-1'>Strategic Financial Technology Partnership</p>
              </div>
              
              <div className='bg-white rounded-lg p-4 border border-slate-200'>
                <label className='block text-sm font-semibold text-slate-700 mb-2'>
                  Contact Email
                </label>
                <input
                  type='email'
                  className='w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200'
                  placeholder='contact@orderinvest.com'
                />
              </div>
            </div>
            
            <div className='mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg'>
              <div className='flex items-start gap-3'>
                <div className='w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center mt-0.5'>
                  <span className='text-blue-600 text-xs font-bold'>ℹ</span>
                </div>
                <div className='text-sm text-blue-800'>
                  <p className='font-medium mb-1'>Partnership Overview</p>
                  <p className='text-xs leading-relaxed'>
                    Order Invest provides strategic financial insights while PipLine delivers cutting-edge technology solutions. 
                    This collaboration creates a powerful platform for modern financial management and investment tracking.
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* System Preferences */}
          <div className='bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl p-6 border border-emerald-200'>
            <div className='flex items-center gap-4 mb-6'>
              <div className='w-12 h-12 bg-gradient-to-br from-emerald-600 to-green-700 rounded-xl flex items-center justify-center shadow-lg'>
                <Globe className='h-6 w-6 text-white' />
              </div>
              <div>
                <h3 className='text-xl font-bold text-slate-900'>
                  System Preferences
                </h3>
                <p className='text-slate-600 font-medium'>Configure your system settings and preferences</p>
              </div>
            </div>
            <div className='grid grid-cols-1 md:grid-cols-2 gap-6'>
              <div className='bg-white rounded-lg p-4 border border-emerald-200'>
                <label className='block text-sm font-semibold text-slate-700 mb-2'>
                  Timezone
                </label>
                <select className='w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200'>
                  <option>Europe/Istanbul (UTC+3)</option>
                  <option>UTC</option>
                  <option>Europe/London (UTC+0)</option>
                  <option>America/New_York (UTC-5)</option>
                  <option>Asia/Dubai (UTC+4)</option>
                </select>
                <p className='text-xs text-slate-500 mt-1'>Default: Europe/Istanbul</p>
              </div>
              
              <div className='bg-white rounded-lg p-4 border border-emerald-200'>
                <label className='block text-sm font-semibold text-slate-700 mb-2'>
                  Language
                </label>
                <select
                  className='w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-colors duration-200'
                  value={safeCurrentLanguage}
                  onChange={e => handleLanguageChange(e.target.value)}
                >
                  {Object.entries(safeSupportedLanguages).map(([code, lang]) => (
                    <option key={code} value={code}>
                      {lang.flag} {lang.name}
                    </option>
                  ))}
                </select>
                <p className='text-xs text-slate-500 mt-1'>Primary: Türkçe</p>
              </div>
            </div>
            
            <div className='mt-4 p-4 bg-emerald-50 border border-emerald-200 rounded-lg'>
              <div className='flex items-start gap-3'>
                <div className='w-5 h-5 bg-emerald-100 rounded-full flex items-center justify-center mt-0.5'>
                  <span className='text-emerald-600 text-xs font-bold'>₺</span>
                </div>
                <div className='text-sm text-emerald-800'>
                  <p className='font-medium mb-1'>Currency Standard</p>
                  <p className='text-xs leading-relaxed'>
                    All financial transactions and calculations are standardized in Turkish Lira (₺) for consistency 
                    across the Order Invest & PipLine platform.
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* Save Button */}
          <div className='flex justify-end pt-4'>
            <button className='inline-flex items-center px-8 py-3 bg-gradient-to-r from-slate-700 to-blue-600 text-white rounded-lg hover:from-slate-800 hover:to-blue-700 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl'>
              <SettingsIcon className='h-5 w-5 mr-2' />
              Save Configuration Changes
            </button>
          </div>
        </div>
      ),
    },
    {
      id: 'dropdowns',
      label: t('settings.dropdown_management'),
      icon: List,
      content: (
        <div className='space-y-6'>
          {/* Professional Header */}
          <div className='bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-6 border border-slate-200'>
            <div className='flex items-center justify-between'>
              <div className='flex items-center gap-4'>
                <div className='w-12 h-12 bg-gradient-to-br from-slate-700 to-blue-600 rounded-xl flex items-center justify-center shadow-lg'>
                  <List className='h-6 w-6 text-white' />
                </div>
                <div>
                  <h3 className='text-2xl font-bold text-slate-900'>
                    Dropdown Management
                  </h3>
                  <p className='text-slate-600 font-medium'>
                    Enterprise-grade configuration management for transaction systems
                  </p>
                </div>
              </div>
              <button
                onClick={() => setShowAddModal(true)}
                className='inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-slate-700 to-blue-600 text-white rounded-lg hover:from-slate-800 hover:to-blue-700 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl'
              >
                <Plus className='h-5 w-5' />
                Add New Option
              </button>
            </div>
          </div>

          {/* Statistics Overview */}
          <div className='grid grid-cols-1 md:grid-cols-4 gap-4'>
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center'>
                  <span className='text-blue-600 font-bold text-lg'>₺</span>
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>Currency Options</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {dropdownOptions['currency']?.length || 0}
                  </p>
                </div>
              </div>
            </div>
            
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center'>
                  <span className='text-emerald-600 font-bold text-lg'>💳</span>
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>Payment Methods</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {dropdownOptions['payment_method']?.length || 0}
                  </p>
                </div>
              </div>
            </div>
            
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center'>
                  <span className='text-purple-600 font-bold text-lg'>🏢</span>
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>PSP/KASA</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {dropdownOptions['psp']?.length || 0}
                  </p>
                </div>
              </div>
            </div>
            
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center'>
                  <span className='text-orange-600 font-bold text-lg'>📊</span>
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>Total Options</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {Object.values(dropdownOptions).reduce((acc, curr) => acc + (curr?.length || 0), 0)}
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* Main Content */}
          {loadingOptions ? (
            <div className='bg-white rounded-xl shadow-sm border border-slate-200 p-8'>
              <div className='text-center'>
                <div className='animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4'></div>
                <p className='text-slate-600 font-medium'>Loading configuration data...</p>
                <p className='text-sm text-slate-500 mt-1'>Please wait while we retrieve your settings</p>
              </div>
            </div>
          ) : (
            <div className='bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden'>
              {/* Table Header */}
              <div className='px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-blue-50'>
                <div className='flex items-center justify-between'>
                  <h4 className='text-lg font-semibold text-slate-900'>
                    Configuration Categories
                  </h4>
                  <div className='flex items-center gap-2'>
                    <span className='text-xs text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200'>
                      {Object.values(dropdownOptions).reduce((acc, curr) => acc + (curr?.length || 0), 0)} Total Items
                    </span>
                  </div>
                </div>
              </div>
              
              {/* Configuration Categories */}
              <div className='divide-y divide-slate-100'>
                {fieldTypes.map(fieldType => (
                  <div key={fieldType.value} className='p-6 hover:bg-slate-50 transition-colors duration-200'>
                    <div className='flex items-center justify-between mb-4'>
                      <div className='flex items-center gap-4'>
                        <div className='w-12 h-12 bg-gradient-to-br from-slate-600 to-blue-600 rounded-lg flex items-center justify-center shadow-sm'>
                          <List className='h-6 w-6 text-white' />
                        </div>
                        <div>
                          <h5 className='text-lg font-bold text-slate-900'>
                            {fieldType.label}
                          </h5>
                          <div className='flex items-center gap-3 mt-1'>
                            <span className='text-sm text-slate-600'>
                              {fieldType.isStatic 
                                ? `${fieldType.staticValues?.length || 0} fixed options`
                                : `${dropdownOptions[fieldType.value]?.length || 0} options configured`
                              }
                            </span>
                            {fieldType.isStatic && (
                              <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800'>
                                Fixed Values
                              </span>
                            )}
                            {fieldType.requiresCommission && (
                              <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800'>
                                Commission Required
                              </span>
                            )}
                          </div>
                        </div>
                      </div>
                      
                      {!fieldType.isStatic && (
                        <button
                          onClick={() => {
                            setFormData(prev => ({ ...prev, field_name: fieldType.value }));
                            setShowAddModal(true);
                          }}
                          className='inline-flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 font-medium text-sm'
                        >
                          <Plus className='h-4 w-4' />
                          Add {fieldType.label}
                        </button>
                      )}
                    </div>

                    {fieldType.isStatic ? (
                      /* Static fields - show fixed values */
                      <div className='bg-slate-50 rounded-lg p-4'>
                        <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3'>
                          {fieldType.staticValues?.map((value, index) => (
                            <div
                              key={index}
                              className='bg-white rounded-lg p-3 border border-slate-200 shadow-sm'
                            >
                              <div className='flex items-center justify-between'>
                                <div className='flex-1'>
                                  <div className='flex items-center gap-2 mb-1'>
                                    <span className='font-semibold text-slate-900 text-sm'>
                                      {value}
                                    </span>
                                    <span className='inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800'>
                                      Fixed
                                    </span>
                                  </div>
                                  <p className='text-xs text-slate-500'>
                                    Static value - cannot be modified
                                  </p>
                                </div>
                                <div className='flex items-center gap-1'>
                                  <Lock className='h-4 w-4 text-slate-400' />
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    ) : dropdownOptions[fieldType.value]?.length > 0 ? (
                      /* Dynamic fields - show manageable options */
                      <div className='bg-slate-50 rounded-lg p-4'>
                        <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3'>
                          {dropdownOptions[fieldType.value].map(option => (
                            <div
                              key={option.id}
                              className='bg-white rounded-lg p-3 border border-slate-200 hover:border-blue-300 hover:shadow-sm transition-all duration-200'
                            >
                              <div className='flex items-center justify-between'>
                                <div className='flex-1'>
                                  <div className='flex items-center gap-2 mb-1'>
                                    <span className='font-semibold text-slate-900 text-sm'>
                                      {option.value}
                                    </span>
                                    {option.commission_rate && (
                                      <span className='inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800'>
                                        {(option.commission_rate * 100).toFixed(1)}%
                                      </span>
                                    )}
                                  </div>
                                  <p className='text-xs text-slate-500'>
                                    ID: {option.id} • Created: {option.created_at ? new Date(option.created_at).toLocaleDateString() : 'N/A'}
                                  </p>
                                </div>
                                <div className='flex items-center gap-1'>
                                  <button
                                    onClick={() => openEditModal(option, fieldType.value)}
                                    className='p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded transition-colors duration-200'
                                    title='Edit option'
                                  >
                                    <Edit className='h-4 w-4' />
                                  </button>
                                  <button
                                    onClick={() => handleDeleteOption(option)}
                                    className='p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors duration-200'
                                    title='Delete option'
                                  >
                                    <Trash2 className='h-4 w-4' />
                                  </button>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    ) : (
                      <div className='text-center py-8 bg-slate-50 rounded-lg'>
                        <div className='w-16 h-16 bg-slate-200 rounded-full flex items-center justify-center mx-auto mb-3'>
                          <List className='h-8 w-8 text-slate-400' />
                        </div>
                        <h6 className='text-slate-600 font-medium mb-1'>No {fieldType.label} configured</h6>
                        <p className='text-sm text-slate-500 mb-3'>
                          Start building your {fieldType.label.toLowerCase()} configuration
                        </p>
                        <button
                          onClick={() => setShowAddModal(true)}
                          className='inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium text-sm'
                        >
                          <Plus className='h-4 w-4' />
                          Add First {fieldType.label}
                        </button>
                      </div>
                    )}
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      ),
    },
    {
      id: 'departments',
      label: t('settings.departments'),
      icon: Building,
      content: (
        <div className='space-y-6'>
          {/* Professional Header */}
          <div className='bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-6 border border-slate-200'>
            <div className='flex items-center justify-between'>
              <div className='flex items-center gap-4'>
                <div className='w-12 h-12 bg-gradient-to-br from-slate-700 to-blue-600 rounded-xl flex items-center justify-center shadow-lg'>
                  <Building className='h-6 w-6 text-white' />
                </div>
                <div>
                  <h3 className='text-2xl font-bold text-slate-900'>
                    Department Management
                  </h3>
                  <p className='text-slate-600 font-medium'>
                    Organizational structure management for Order Invest & PipLine operations
                  </p>
                </div>
              </div>
              <button
                onClick={() => openDepartmentModal()}
                className='inline-flex items-center gap-3 px-6 py-3 bg-gradient-to-r from-slate-700 to-blue-600 text-white rounded-lg hover:from-slate-800 hover:to-blue-700 transition-all duration-200 font-semibold shadow-lg hover:shadow-xl'
              >
                <Plus className='h-5 w-5' />
                Add New Department
              </button>
            </div>
          </div>

          {/* Statistics Overview */}
          <div className='grid grid-cols-1 md:grid-cols-3 gap-4'>
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center'>
                  <Building className='h-5 w-5 text-blue-600' />
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>Total Departments</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {departments.length}
                  </p>
                </div>
              </div>
            </div>
            
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center'>
                  <Users className='h-5 w-5 text-emerald-600' />
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>Active Teams</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {departments.filter(dept => ['Conversion', 'Retention', 'Marketing', 'Research', 'Operation'].includes(dept)).length}
                  </p>
                </div>
              </div>
            </div>
            
            <div className='bg-white rounded-lg p-4 border border-slate-200 shadow-sm'>
              <div className='flex items-center gap-3'>
                <div className='w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center'>
                  <Building2 className='h-5 w-5 text-purple-600' />
                </div>
                <div>
                  <p className='text-xs text-slate-500 font-medium'>Support Functions</p>
                  <p className='text-xl font-bold text-slate-900'>
                    {departments.filter(dept => ['Management', 'Facility'].includes(dept)).length}
                  </p>
                </div>
              </div>
            </div>
          </div>

          {/* Main Content */}
          {loadingDepartments ? (
            <div className='bg-white rounded-xl shadow-sm border border-slate-200 p-8'>
              <div className='text-center'>
                <div className='animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4'></div>
                <p className='text-slate-600 font-medium'>Loading organizational structure...</p>
                <p className='text-sm text-slate-500 mt-1'>Please wait while we retrieve your department configuration</p>
              </div>
            </div>
          ) : (
            <div className='bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden'>
              {/* Table Header */}
              <div className='px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-blue-50'>
                <div className='flex items-center justify-between'>
                  <h4 className='text-lg font-semibold text-slate-900'>
                    Organizational Structure
                  </h4>
                  <div className='flex items-center gap-2'>
                    <span className='text-xs text-slate-500 bg-white px-2 py-1 rounded-full border border-slate-200'>
                      {departments.length} Departments
                    </span>
                  </div>
                </div>
              </div>
              
              {departments.length === 0 ? (
                <div className='text-center py-12 px-6'>
                  <div className='w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-4'>
                    <Building className='h-10 w-10 text-slate-400' />
                  </div>
                  <h3 className='text-lg font-semibold text-slate-900 mb-2'>
                    No departments configured
                  </h3>
                  <p className='text-slate-500 mb-6 max-w-md mx-auto text-sm'>
                    Start building your organizational structure to organize agents and team operations 
                    across the Order Invest & PipLine platform.
                  </p>
                  <button 
                    onClick={() => openDepartmentModal()}
                    className='inline-flex items-center px-6 py-3 border border-transparent rounded-lg text-sm font-medium text-white bg-gradient-to-r from-slate-700 to-blue-600 hover:from-slate-800 hover:to-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors shadow-sm'
                  >
                    <Plus className='h-4 w-4 mr-2' />
                    Create Your First Department
                  </button>
                </div>
              ) : (
                <div className='divide-y divide-slate-100'>
                  {departments.map((department, index) => (
                    <div key={index} className='p-6 hover:bg-slate-50 transition-colors duration-200'>
                      <div className='flex items-center justify-between'>
                        <div className='flex items-center gap-4'>
                          <div className='w-12 h-12 bg-gradient-to-br from-slate-600 to-blue-600 rounded-lg flex items-center justify-center shadow-sm'>
                            <Building className='h-6 w-6 text-white' />
                          </div>
                          <div>
                            <h4 className='text-lg font-bold text-slate-900'>
                              {department}
                            </h4>
                            <div className='flex items-center gap-3 mt-1'>
                              <span className='text-sm text-slate-600'>
                                Department ID: {index + 1}
                              </span>
                              {['Conversion', 'Retention', 'Marketing', 'Research', 'Operation'].includes(department) && (
                                <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800'>
                                  Core Team
                                </span>
                              )}
                              {['Management', 'Facility'].includes(department) && (
                                <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800'>
                                  Support Function
                                </span>
                              )}
                            </div>
                          </div>
                        </div>
                        <div className='flex items-center gap-2'>
                          <button
                            onClick={() => openDepartmentModal(department)}
                            className='inline-flex items-center gap-2 px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 font-medium text-sm'
                            title='Edit department'
                          >
                            <Edit className='h-4 w-4' />
                            Edit
                          </button>
                          <button
                            onClick={() => handleDeleteDepartment(department)}
                            className='inline-flex items-center gap-2 px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors duration-200 font-medium text-sm'
                            title='Delete department'
                          >
                            <Trash2 className='h-4 w-4' />
                            Delete
                          </button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          )}
        </div>
      ),
    },
    {
      id: 'admin',
      label: t('settings.system_administration'),
      icon: Shield,
      content: (
        <div className='space-y-5'>
          {!showSystemMonitor ? (
            <div className='space-y-5'>
              <div className='flex items-center justify-between'>
                <div>
                  <h3 className='text-lg font-medium text-gray-900'>
                    System Administration
                  </h3>
                  <p className='text-sm text-gray-600'>
                    Manage system settings, monitoring, and administrative functions
                  </p>
                </div>
              </div>
              <div className='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4'>
                <div className='p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 hover:border-blue-300 hover:shadow-sm'>
                  <Users className='h-7 w-7 text-blue-600 mb-2' />
                  <h4 className='font-medium text-gray-900 text-sm'>
                    {t('settings.user_management')}
                  </h4>
                  <p className='text-xs text-gray-500'>
                    {t('settings.manage_system_users')}
                  </p>
                </div>
                <div className='p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 hover:border-green-300 hover:shadow-sm'>
                  <Lock className='h-7 w-7 text-green-600 mb-2' />
                  <h4 className='font-medium text-gray-900 text-sm'>
                    {t('settings.permissions')}
                  </h4>
                  <p className='text-xs text-gray-500'>
                    {t('settings.configure_access_controls')}
                  </p>
                </div>
                <div 
                  className='p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 hover:border-purple-300 hover:shadow-md'
                  onClick={navigateToMonitor}
                >
                  <Monitor className='h-7 w-7 text-purple-600 mb-2' />
                  <h4 className='font-medium text-gray-900 text-sm'>
                    System Monitor
                  </h4>
                  <p className='text-xs text-gray-500'>
                    Real-time system performance and health monitoring
                  </p>
                </div>
                <div className='p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 hover:border-orange-300 hover:shadow-sm'>
                  <Database className='h-7 w-7 text-orange-600 mb-2' />
                  <h4 className='font-medium text-gray-900 text-sm'>
                    {t('settings.database')}
                  </h4>
                  <p className='text-xs text-gray-500'>
                    {t('settings.database_management')}
                  </p>
                </div>
                <div className='p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 hover:border-red-300 hover:shadow-sm'>
                  <Database className='h-7 w-7 text-red-600 mb-2' />
                  <h4 className='font-medium text-gray-900 text-sm'>
                    {t('settings.backup_restore')}
                  </h4>
                  <p className='text-xs text-gray-500'>
                    {t('settings.data_backup_recovery')}
                  </p>
                </div>
                <div className='p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-all duration-200 hover:border-indigo-300 hover:shadow-sm'>
                  <Shield className='h-7 w-7 text-indigo-600 mb-2' />
                  <h4 className='font-medium text-gray-900 text-sm'>
                    {t('settings.security')}
                  </h4>
                  <p className='text-xs text-gray-500'>
                    {t('settings.security_settings')}
                  </p>
                </div>
              </div>
            </div>
          ) : (
            <div className='space-y-4'>
              {/* Back Button */}
              <div className='flex items-center gap-4'>
                <button
                  onClick={navigateBackToAdmin}
                  className='inline-flex items-center gap-2 px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors duration-200'
                >
                  <span>←</span>
                  Back to Administration
                </button>
                <div className='h-6 w-px bg-gray-300'></div>
                <div className='flex items-center gap-2'>
                  <Monitor className='h-5 w-5 text-purple-600' />
                  <h3 className='text-lg font-medium text-gray-900'>System Monitor</h3>
                </div>
              </div>
              
              {/* System Monitor Component */}
              <div className='bg-white rounded-lg border border-gray-200 overflow-hidden'>
                <Suspense fallback={<LoadingSpinner />}>
                  <SystemMonitor />
                </Suspense>
              </div>
            </div>
          )}
        </div>
      ),
    },
    {
      id: 'notifications',
      label: t('settings.notifications'),
      icon: Bell,
      content: (
        <div className='space-y-6'>
          <div className='bg-gradient-to-r from-orange-50 to-red-50 rounded-xl p-6 border border-orange-100'>
            <div className='flex items-center gap-3 mb-5'>
              <div className='w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-lg flex items-center justify-center shadow-sm'>
                <Bell className='h-5 w-5 text-white' />
              </div>
              <div>
                <h3 className='text-lg font-bold text-gray-900'>
                  Notification Settings
                </h3>
                <p className='text-sm text-gray-600'>Configure how you receive notifications and alerts</p>
              </div>
            </div>
            <div className='space-y-4'>
              <div className='bg-white rounded-lg p-5 border border-orange-200'>
                <div className='flex items-center justify-between'>
                  <div className='flex items-center gap-3'>
                    <div className='w-8 h-8 bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg flex items-center justify-center'>
                      <Mail className='h-4 w-4 text-white' />
                    </div>
                    <div>
                      <h4 className='font-semibold text-gray-900 text-sm'>
                        Email Notifications
                      </h4>
                      <p className='text-xs text-gray-500'>
                        Receive important updates via email
                      </p>
                    </div>
                  </div>
                  <label className='relative inline-flex items-center cursor-pointer'>
                    <input type='checkbox' className='sr-only peer' />
                    <div className="w-10 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-orange-500"></div>
                  </label>
                </div>
              </div>
              
              <div className='bg-white rounded-lg p-5 border border-orange-200'>
                <div className='flex items-center justify-between'>
                  <div className='flex items-center gap-3'>
                    <div className='w-8 h-8 bg-gradient-to-br from-green-500 to-green-600 rounded-lg flex items-center justify-center'>
                      <Phone className='h-4 w-4 text-white' />
                    </div>
                    <div>
                      <h4 className='font-semibold text-gray-900 text-sm'>
                        SMS Notifications
                      </h4>
                      <p className='text-xs text-gray-500'>
                        Get urgent alerts via text message
                      </p>
                    </div>
                  </div>
                  <label className='relative inline-flex items-center cursor-pointer'>
                    <input type='checkbox' className='sr-only peer' />
                    <div className="w-10 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-orange-500"></div>
                  </label>
                </div>
              </div>
              
              <div className='bg-white rounded-lg p-5 border border-orange-200'>
                <div className='flex items-center justify-between'>
                  <div className='flex items-center gap-3'>
                    <div className='w-8 h-8 bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg flex items-center justify-center'>
                      <Bell className='h-4 w-4 text-white' />
                    </div>
                    <div>
                      <h4 className='font-semibold text-gray-900 text-sm'>
                        Push Notifications
                      </h4>
                      <p className='text-xs text-gray-500'>
                        Receive real-time browser notifications
                      </p>
                    </div>
                  </div>
                  <label className='relative inline-flex items-center cursor-pointer'>
                    <input type='checkbox' className='sr-only peer' />
                    <div className="w-10 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-orange-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-orange-500"></div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      ),
    },
    {
      id: 'integrations',
      label: t('settings.integrations'),
      icon: Globe,
      content: (
        <div className='space-y-6'>
          {/* Professional Header */}
          <div className='bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-6 border border-slate-200'>
            <div className='flex items-center gap-4'>
              <div className='w-12 h-12 bg-gradient-to-br from-slate-700 to-blue-600 rounded-xl flex items-center justify-center shadow-lg'>
                <Globe className='h-6 w-6 text-white' />
              </div>
              <div>
                <h3 className='text-2xl font-bold text-slate-900'>
                  System Integrations
                </h3>
                <p className='text-slate-600 font-medium'>
                  Connect external services and APIs to enhance Order Invest & PipLine functionality
                </p>
              </div>
            </div>
          </div>

          {/* Integration Categories */}
          <div className='grid grid-cols-1 lg:grid-cols-2 gap-6'>
            {/* API Integrations */}
            <div className='bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden'>
              <div className='px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-blue-50'>
                <h4 className='text-lg font-semibold text-slate-900'>
                  API Integrations
                </h4>
                <p className='text-sm text-slate-600'>Connect external financial data sources</p>
              </div>
              <div className='p-6 space-y-4'>
                <div className='p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors duration-200'>
                  <div className='flex items-center justify-between'>
                    <div className='flex items-center gap-3'>
                      <div className='w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center'>
                        <TrendingUp className='h-5 w-5 text-blue-600' />
                      </div>
                      <div>
                        <h5 className='font-semibold text-slate-900 text-sm'>
                          Exchange Rate APIs
                        </h5>
                        <p className='text-xs text-slate-500'>
                          Real-time currency conversion data
                        </p>
                      </div>
                    </div>
                    <div className='flex items-center gap-2'>
                      <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800'>
                        Active
                      </span>
                      <button className='px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 text-xs font-medium'>
                        Configure
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className='p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors duration-200'>
                  <div className='flex items-center justify-between'>
                    <div className='flex items-center gap-3'>
                      <div className='w-10 h-10 bg-emerald-100 rounded-lg flex items-center justify-center'>
                        <Building className='h-5 w-5 text-emerald-600' />
                      </div>
                      <div>
                        <h5 className='font-semibold text-slate-900 text-sm'>
                          Banking APIs
                        </h5>
                        <p className='text-xs text-slate-500'>
                          Account balance and transaction sync
                        </p>
                      </div>
                    </div>
                    <div className='flex items-center gap-2'>
                      <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800'>
                        Pending
                      </span>
                      <button className='px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 text-xs font-medium'>
                        Setup
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className='p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors duration-200'>
                  <div className='flex items-center justify-between'>
                    <div className='flex items-center gap-3'>
                      <div className='w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center'>
                        <BarChart3 className='h-5 w-5 text-purple-600' />
                      </div>
                      <div>
                        <h5 className='font-semibold text-slate-900 text-sm'>
                          Market Data APIs
                        </h5>
                        <p className='text-xs text-slate-500'>
                          Stock prices and market analytics
                        </p>
                      </div>
                    </div>
                    <div className='flex items-center gap-2'>
                      <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-slate-100 text-slate-600'>
                        Inactive
                      </span>
                      <button className='px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 text-xs font-medium'>
                        Enable
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* Data Integrations */}
            <div className='bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden'>
              <div className='px-6 py-4 border-b border-slate-200 bg-gradient-to-r from-slate-50 to-emerald-50'>
                <h4 className='text-lg font-semibold text-slate-900'>
                  Data Integrations
                </h4>
                <p className='text-sm text-slate-600'>Import and export data from external sources</p>
              </div>
              <div className='p-6 space-y-4'>
                <div className='p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors duration-200'>
                  <div className='flex items-center justify-between'>
                    <div className='flex items-center gap-3'>
                      <div className='w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center'>
                        <FileText className='h-5 w-5 text-orange-600' />
                      </div>
                      <div>
                        <h5 className='font-semibold text-slate-900 text-sm'>
                          Excel/CSV Import
                        </h5>
                        <p className='text-xs text-slate-500'>
                          Bulk transaction data import
                        </p>
                      </div>
                    </div>
                    <div className='flex items-center gap-2'>
                      <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800'>
                        Active
                      </span>
                      <button className='px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 text-xs font-medium'>
                        Manage
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className='p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors duration-200'>
                  <div className='flex items-center justify-between'>
                    <div className='flex items-center gap-3'>
                      <div className='w-10 h-10 bg-indigo-100 rounded-lg flex items-center justify-center'>
                        <RefreshCw className='h-5 w-5 text-indigo-600' />
                      </div>
                      <div>
                        <h5 className='font-semibold text-slate-900 text-sm'>
                          Database Sync
                        </h5>
                        <p className='text-xs text-slate-500'>
                          Real-time data synchronization
                        </p>
                      </div>
                    </div>
                    <div className='flex items-center gap-2'>
                      <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800'>
                        Active
                      </span>
                      <button className='px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 text-xs font-medium'>
                        Monitor
                      </button>
                    </div>
                  </div>
                </div>
                
                <div className='p-4 border border-slate-200 rounded-lg hover:bg-slate-50 transition-colors duration-200'>
                  <div className='flex items-center justify-between'>
                    <div className='flex items-center gap-3'>
                      <div className='w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center'>
                        <Download className='h-5 w-5 text-red-600' />
                      </div>
                      <div>
                        <h5 className='font-semibold text-slate-900 text-sm'>
                          Report Export
                        </h5>
                        <p className='text-xs text-slate-500'>
                          Automated report generation
                        </p>
                      </div>
                    </div>
                    <div className='flex items-center gap-2'>
                      <span className='inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800'>
                        Active
                      </span>
                      <button className='px-3 py-1.5 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 text-xs font-medium'>
                        Configure
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          {/* Integration Status Overview */}
          <div className='bg-white rounded-xl shadow-sm border border-slate-200 p-6'>
            <h4 className='text-lg font-semibold text-slate-900 mb-4'>
              Integration Health Status
            </h4>
            <div className='grid grid-cols-1 md:grid-cols-4 gap-4'>
              <div className='text-center p-4 bg-green-50 rounded-lg border border-green-200'>
                <div className='w-8 h-8 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-2'>
                  <CheckCircle className='h-5 w-5 text-green-600' />
                </div>
                <p className='text-sm font-medium text-green-800'>Active</p>
                <p className='text-xs text-green-600'>4 Integrations</p>
              </div>
              
              <div className='text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200'>
                <div className='w-8 h-8 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-2'>
                  <Clock className='h-5 w-5 text-yellow-600' />
                </div>
                <p className='text-sm font-medium text-yellow-800'>Pending</p>
                <p className='text-xs text-yellow-600'>1 Integration</p>
              </div>
              
              <div className='text-center p-4 bg-slate-50 rounded-lg border border-slate-200'>
                <div className='w-8 h-8 bg-slate-100 rounded-full flex items-center justify-center mx-auto mb-2'>
                  <Circle className='h-5 w-5 text-slate-600' />
                </div>
                <p className='text-sm font-medium text-slate-800'>Inactive</p>
                <p className='text-xs text-slate-600'>1 Integration</p>
              </div>
              
              <div className='text-center p-4 bg-blue-50 rounded-lg border border-blue-200'>
                <div className='w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-2'>
                  <BarChart3 className='h-5 w-5 text-blue-600' />
                </div>
                <p className='text-sm font-medium text-blue-800'>Total</p>
                <p className='text-xs text-blue-600'>6 Integrations</p>
              </div>
            </div>
          </div>

          {/* Integration Actions */}
          <div className='bg-gradient-to-r from-slate-50 to-blue-50 rounded-xl p-6 border border-slate-200'>
            <div className='flex items-center justify-between'>
              <div>
                <h4 className='text-lg font-semibold text-slate-900 mb-2'>
                  Need More Integrations?
                </h4>
                <p className='text-sm text-slate-600'>
                  Contact our integration team to add custom APIs and services
                </p>
              </div>
              <div className='flex items-center gap-3'>
                <button className='px-4 py-2 bg-slate-100 text-slate-700 rounded-lg hover:bg-slate-200 transition-colors duration-200 font-medium text-sm'>
                  View Documentation
                </button>
                <button className='px-6 py-2 bg-gradient-to-r from-slate-700 to-blue-600 text-white rounded-lg hover:from-slate-800 hover:to-blue-700 transition-all duration-200 font-medium text-sm'>
                  Request Integration
                </button>
              </div>
            </div>
          </div>
        </div>
      ),
    },
  ];

  return (
    <div className='space-y-6'>
      {/* Enhanced Header */}
      <PageHeader
        title="Settings"
        subtitle="Application settings"
      />

      {/* Enhanced Tabs */}
      <div className='bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden'>
        <div className='bg-gradient-to-r from-gray-50 to-gray-100/50 px-6 py-4 border-b border-gray-100'>
          <nav className='flex space-x-1 overflow-x-auto'>
            {tabs.map(tab => (
              <div key={tab.id} className="flex items-center gap-2">
                <button
                  onClick={() => setActiveTab(tab.id)}
                  className={`tab-button px-5 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 flex items-center gap-2 whitespace-nowrap ${
                    activeTab === tab.id
                      ? 'bg-white text-blue-600 shadow-md border border-gray-200'
                      : 'text-gray-600 hover:text-gray-800 hover:bg-white/50'
                  }`}
                >
                  <tab.icon className='h-4 w-4' />
                  {tab.label === 'settings.general' ? 'General' :
                   tab.label === 'settings.dropdown_management' ? 'Dropdown Management' :
                   tab.label === 'settings.departments' ? 'Departments' :
                   tab.label === 'settings.system_administration' ? 'System Administration' :
                   tab.label === 'settings.notifications' ? 'Notifications' :
                   tab.label === 'settings.integrations' ? 'Integrations' : tab.label}
                </button>
                {activeTab === tab.id && (
                  <button
                    onClick={() => {
                      // Refresh data based on active tab
                      if (tab.id === 'dropdowns') {
                        fetchDropdownOptions();
                      } else if (tab.id === 'departments') {
                        fetchDepartments();
                      } else {
                        // For other tabs, refresh the page
                        window.location.reload();
                      }
                    }}
                    className="p-1.5 text-gray-500 hover:text-gray-700 hover:bg-white/60 rounded-lg transition-all duration-200 hover:shadow-sm"
                    title={`Refresh ${tab.label} data`}
                  >
                    <RefreshCw className="h-4 w-4" />
                  </button>
                )}
              </div>
            ))}
          </nav>
        </div>

        {/* Enhanced Tab Content */}
        <div className='p-6'>
          {tabs.find(tab => tab.id === activeTab)?.content}
        </div>
      </div>

      {/* Add Option Modal */}
      {showAddModal && (
        <div className='fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' onClick={() => setShowAddModal(false)}>
          <div className='bg-white rounded-xl max-w-md w-full' onClick={(e) => e.stopPropagation()}>
            <div className='p-5 border-b border-gray-100'>
              <div className='flex items-center justify-between'>
                <h3 className='text-lg font-semibold text-gray-900'>
                  {t('settings.add_option')}
                </h3>
                <button
                  onClick={() => setShowAddModal(false)}
                  className='p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors duration-200'
                >
                  <X className='h-4 w-4' />
                </button>
              </div>
            </div>
            <div className='p-5 space-y-4'>
              <div>
                <label className='block text-sm font-medium text-gray-700 mb-2'>
                  {t('settings.field_type')}
                </label>
                <select
                  value={formData.field_name}
                  onChange={e =>
                    setFormData(prev => ({
                      ...prev,
                      field_name: e.target.value,
                    }))
                  }
                  className='w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500'
                >
                  <option value=''>Select field type...</option>
                  {fieldTypes.filter(field => !field.isStatic).map(field => (
                    <option key={field.value} value={field.value}>
                      {field.label}
                    </option>
                  ))}
                </select>
              </div>
              <div>
                <label className='block text-sm font-medium text-gray-700 mb-2'>
                  {t('settings.option_value')}
                </label>
                <input
                  type='text'
                  value={formData.value}
                  onChange={e =>
                    setFormData(prev => ({ ...prev, value: e.target.value }))
                  }
                  className='w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500'
                  placeholder='Enter option value...'
                />
              </div>
              {fieldTypes.find(f => f.value === formData.field_name)
                ?.requiresCommission && (
                <div>
                  <label className='block text-sm font-medium text-gray-700 mb-2'>
                    {t('settings.commission_rate_required')}
                  </label>
                  <input
                    type='number'
                    step='0.01'
                    min='0'
                    max='1'
                    value={formData.commission_rate}
                    onChange={e =>
                      setFormData(prev => ({
                        ...prev,
                        commission_rate: e.target.value,
                      }))
                    }
                    className='w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500'
                    placeholder='0.025 (2.5%)'
                    required
                  />
                </div>
              )}
            </div>
            <div className='p-5 border-t border-gray-100 flex gap-3'>
              <button
                onClick={() => setShowAddModal(false)}
                className='flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200'
              >
                Cancel
              </button>
              <button
                onClick={handleAddOption}
                disabled={
                  !formData.field_name ||
                  !formData.value ||
                  (fieldTypes.find(f => f.value === formData.field_name)
                    ?.requiresCommission &&
                    !formData.commission_rate)
                }
                className='flex-1 px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors duration-200 disabled:opacity-50'
              >
                {t('settings.add_option')}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Edit Option Modal */}
      {showEditModal && editingOption && (
        <div className='fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4' onClick={() => setShowEditModal(false)}>
          <div className='bg-white rounded-xl max-w-md w-full' onClick={(e) => e.stopPropagation()}>
            <div className='p-5 border-b border-gray-100'>
              <div className='flex items-center justify-between'>
                <h3 className='text-lg font-semibold text-gray-900'>
                  {t('settings.edit_option')}
                </h3>
                <button
                  onClick={() => setShowEditModal(false)}
                  className='p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors duration-200'
                >
                  <X className='h-4 w-4' />
                </button>
              </div>
            </div>
            <div className='p-5 space-y-4'>
              <div>
                <label className='block text-sm font-medium text-gray-700 mb-2'>
                  {t('settings.field_type')}
                </label>
                <input
                  type='text'
                  value={
                    fieldTypes.find(f => f.value === formData.field_name)
                      ?.label || formData.field_name
                  }
                  className='w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50'
                  disabled
                />
              </div>
              <div>
                <label className='block text-sm font-medium text-gray-700 mb-2'>
                  {t('settings.option_value')}
                </label>
                <input
                  type='text'
                  value={formData.value}
                  onChange={e =>
                    setFormData(prev => ({ ...prev, value: e.target.value }))
                  }
                  className='w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500'
                  placeholder='Enter option value...'
                />
              </div>
              {fieldTypes.find(f => f.value === formData.field_name)
                ?.requiresCommission && (
                <div>
                  <label className='block text-sm font-medium text-gray-700 mb-2'>
                    {t('settings.commission_rate_required')}
                  </label>
                  <input
                    type='number'
                    step='0.01'
                    min='0'
                    max='1'
                    value={formData.commission_rate}
                    onChange={e =>
                      setFormData(prev => ({
                        ...prev,
                        commission_rate: e.target.value,
                      }))
                    }
                    className='w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent-500 focus:border-accent-500'
                    placeholder='0.025 (2.5%)'
                    required
                  />
                </div>
              )}
            </div>
            <div className='p-5 border-t border-gray-100 flex gap-3'>
              <button
                onClick={() => setShowEditModal(false)}
                className='flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200'
              >
                Cancel
              </button>
              <button
                onClick={handleEditOption}
                disabled={
                  !formData.value ||
                  (fieldTypes.find(f => f.value === formData.field_name)
                    ?.requiresCommission &&
                    !formData.commission_rate)
                }
                className='flex-1 px-4 py-2 bg-accent-600 text-white rounded-lg hover:bg-accent-700 transition-colors duration-200 disabled:opacity-50'
              >
                {t('settings.edit_option')}
              </button>
            </div>
          </div>
        </div>
      )}

      {/* Department Modal */}
      {showDepartmentModal && (
        <div className='fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4'>
          <div className='bg-white rounded-xl max-w-md w-full'>
            <div className='p-5 border-b border-gray-100'>
              <div className='flex items-center justify-between'>
                <h3 className='text-lg font-semibold text-gray-900'>
                  {isEditingDepartment ? 'Edit Department' : 'Add New Department'}
                </h3>
                <button
                  onClick={() => setShowDepartmentModal(false)}
                  className='p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors duration-200'
                >
                  <X className='h-4 w-4' />
                </button>
              </div>
            </div>
            <div className='p-5 space-y-4'>
              <div>
                <label className='block text-sm font-medium text-gray-700 mb-2'>
                  Department Name
                </label>
                <input
                  type='text'
                  value={isEditingDepartment ? editingDepartment : newDepartment}
                  onChange={e => 
                    isEditingDepartment 
                      ? setEditingDepartment(e.target.value)
                      : setNewDepartment(e.target.value)
                  }
                  className='w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500'
                  placeholder='Enter department name...'
                  autoFocus
                />
              </div>
              <div className='bg-blue-50 border border-blue-200 rounded-lg p-4'>
                <div className='flex items-start gap-2'>
                  <div className='w-5 h-5 bg-blue-100 rounded-full flex items-center justify-center mt-0.5'>
                    <span className='text-blue-600 text-xs font-bold'>i</span>
                  </div>
                  <div className='text-sm text-blue-800'>
                    <p className='font-medium mb-1'>Department Management</p>
                    <p className='text-xs'>
                      {isEditingDepartment 
                        ? 'Editing a department will update it across the entire system, including all existing agents assigned to this department.'
                        : 'New departments will be available immediately for assigning to agents and will appear in the department tabs.'
                      }
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div className='p-5 border-t border-gray-100 flex gap-3'>
              <button
                onClick={() => setShowDepartmentModal(false)}
                className='flex-1 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors duration-200'
              >
                Cancel
              </button>
              <button
                onClick={isEditingDepartment ? handleEditDepartment : handleAddDepartment}
                disabled={
                  isEditingDepartment 
                    ? !editingDepartment.trim()
                    : !newDepartment.trim()
                }
                className='flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 disabled:opacity-50'
              >
                {isEditingDepartment ? 'Update Department' : 'Add Department'}
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
